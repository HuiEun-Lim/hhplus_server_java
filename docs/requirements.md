# 요구사항 분석

## 결제 금액

### 📌 잔액 충전 API :  POST “/point”

- 사용자 번호, 충전 결제 금액을 매개변수로 한다.
- 사용자 정보에 없는 사용자 번호의 경우 충전할 수 없다.
- 충전할 포인트가 0 이하인 경우 충전할 수 없다.
- 포인트는 10원 단위로 충전할 수 있다.
- 기존 결제 금액에 충전할 결제 금액을 더한다.

### 📌 잔액 조회 API : GET “/point”

- 사용자 번호를 매개변수로 한다.
- 사용자 정보에 없는 사용자 ID의 경우 조회할 수 없다.
- 사용자의 충전된 결제 금액을 보여준다.
- 충전한 내역이 없는 사용자의 경우 포인트를 0으로 조회한다.

## 상품

`조회시점의 상품별 잔여수량이 정확하면 좋습니다.` ➡️ *주문할 때도 동시성 제어 해라~*

### 📌 상품 목록 조회 API : GET “/goods”

- 상품 목록을 조회한다.
- 상품의 번호, 이름, 가격, 잔여 수량을 조회한다.

### 📌 상위 상품 조회 API : GET “/goods/best”

`통계 정보를 다루기 위한 기술적 고민을 충분히 해보도록 합니다.`

- 최근 3일간 가장 많이 팔린 상위 5개의 상품 정보 목록을 제공한다.

*공유 메모리에 올리거나 통계 조회용 뷰 생성…?*

## 쿠폰

### 📌 쿠폰 발급 API : POST “/coupons”

- 사용자 번호와 쿠폰 번호를 파라미터로 받는다.
- 사용자 정보에 없는 사용자 번호의 경우 발급 할 수 없다.
- 이미 발급한 쿠폰은 재발급 할 수 없다.
- 쿠폰 정보에 없는 쿠폰 번호의 경우 발급 할 수 없다.
- 쿠폰 정보에 있는 최대 발급 수량보다 초과 발급할 수 없다.
- 사용자에게 쿠폰이 발급된다.

### 📌 보유 쿠폰 목록 조회 API : GET “/coupons”

- 사용자 번호를 파라미터로 받는다.
- 사용자 정보에 없는 사용자 번호의 경우 조회 할 수 없다.
- 이미 사용한 쿠폰은 조회하지 않는다.
- 사용 기간이 유효한 쿠폰의 목록을 보여준다.

## 주문/결제

> 데이터 분석을 위해 결제 성공 시에 실시간으로 주문 정보를 데이터 플랫폼에 전송해야 합니다.
( 데이터 플랫폼이 어플리케이션 `외부` 라는 가정만 지켜 작업해 주시면 됩니다 )
>
>
> `데이터 플랫폼으로의 전송 기능은 Mock API, Fake Module 등 다양한 방법으로 접근해 봅니다.`
>

### 📌 주문 API : POST “/order”

- 사용자 번호, 주문 상품 객체 목록, 쿠폰 번호를 파라미터로 받는다.
    - 주문 상품 객체에는 상품 번호, 주문 수량을 필수로 한다.
    - 쿠폰 번호는 필수가 아니다.
- 사용자 정보에 없는 사용자 번호의 경우 주문할 수 없다.
- 상품 정보에 없는 상품 번호일 경우 주문 할 수 없다.
- 상품의 재고가 주문하려는 수량보다 적을 경우 주문할 수 없다.
- 쿠폰 정보에 없는 쿠폰 번호의 경우 쿠폰을 사용할 수 없다.
- 이미 사용한 쿠폰일 경우 쿠폰을 사용할 수 없다.
- 현재 사용 기한이 유효하지 않은 쿠폰일 경우 쿠폰을 사용할 수 없다.
- 상품의 판매가를 계산한다.
    - 상품의 판매가는 상품 가격의 합에서 쿠폰 할인을 적용한 가격이다.
    - 쿠폰의 할인 유형(정액/정률)과 최대 할인가를 고려하여 판매가를 계산한다.
    - 쿠폰이 없다면 상품 가격의 합을 판매가로 계산한다.
- 상품의 재고 수량을 차감한다.
- 주문 정보에 해당 주문 내역을 저장한다.
- 주문 상품 정보에 상품 정보를 저장한다.
- 쿠폰이 있다면 쿠폰의 상태를 변경한다.

### 📌 결제 API : POST “/order/pay”

- 사용자 번호, 주문 번호를 매개변수로 갖는다.
- 사용자 정보에 없는 사용자 번호의 경우 주문할 수 없다.
- 사용자의 충전 결제 잔액이 상품의 판매가보다 적다면 주문할 수 없다.
- 사용자의 충전 결제 잔액에서 판매가를 차감한다.
- 주문 정보에서 상태값을 결제 완료로 변경해준다.

## 추가 정책

- 하나만 사도 무료 배송📦
- 쿠폰은 단일 사용만 가능하다. (다른 쿠폰과 중복 사용❌)

<aside>
💡

**KEY POINT**

</aside>

- 각 상품의 재고 관리가 정상적으로 이루어져 잘못된 주문이 발생하지 않도록 해야 합니다.
- 동시에 여러 주문이 들어올 경우, 유저의 보유 잔고에 대한 처리가 정확해야 합니다.