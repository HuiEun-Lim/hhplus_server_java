# Chapter 2. 회고록

## 시작하면서

항해 플러스 백엔드 7기를 시작한지 벌써 5주차, 10주라는 여정에서 반을 달려왔다.

테스트 코드에 익숙해지는 1주차, 동시성 제어를 습득하는 2주차를 지나 3,4,5주차는 지난 주차에서 배운 것들을 토대로 앞으로의 항해를 위한 기반을 닦는 작업이 되지 않았을까 싶다.

남은 6~10주차를 해당 과제로 진행해야한다는 부담감에 욕심이 앞서 실수하고 엉망인 부분도 많지만 이것을 정리해나가는 것도 항해에서 배울 수 있는 중요 포인트일 것이라고 생각한다. 그러니 너무 낙담하지 않고 계속 앞으로 나아가길 스스로에게 바라본다.

## 내가 해낸 것들

알렉스 코치님께 `회고록에 무엇을 작성하면 좋을까요?` 라는 질문을 드렸는데 무엇을 해냈는지는 요구사항에 적혀있으니 **내가 무엇을 해냈는지**를 작성하는 것을 권장받았다.

*내가 무엇을 했는가… 내가 무엇을 했냐고? 이게 요구사항과 다를 게 뭐가 있지…?*

아마도 코치님께서는 내가 무슨 기능을 구현했는지보다는 그 구현을 위해 어떻게 노력을 했는지를 적으라고 하신 게 아닐까 감히 예측해본다.

3주동안 설계와 기능 구현을 하면서 정말 많은 것들을 했지만 이 글을 쓰는 나와 이 글을 읽는 모든 사람들의 시간을 위해 몇개만 적어보고자 한다.

### 파라미터 검증은 도대체 어디에서?
1주차 과제에서 파라미터를 서비스단에서 처리를 했다. 그렇게 돌아온 피드백은 `아주 기본적인 파라미터에 대한 검증은 서비스가 아닌 컨트롤러에서 해준다면 서비스 로직이 메인 로직에 집중할 수 있을 것 같아요.` 였다.
아! 파라미터 검증은 컨트롤러에서 해주면 되는구나!!
라고 했지만 엥? 컨트롤러에서 어떻게 하나하나 해주지??  컨트롤러 함수 안에서? 아님 @valid?

우리에겐 클린 아키텍처를 위해 만든 파사드 패턴이 있다. 파사드 계층에서 해준다면 컨트롤러는 깔끔하게, 서비스는 비즈니스 메인 로직에 집중! 얼마나 좋은가!!!

그런데 말입니다… 사용자 정보 확인과 같이 반복적으로 쓰이는 파라미터 검증이 파사드에 있으면 매번 불러줘야 한단 말이죠? 그렇다면 서비스에서 한번에 관리되는 게 낫지 않을까요? 

그렇게 파사드와 서비스를 오가다가 결국 파라미터 검증 유틸을 따로 만들어서 관리했다. 유틸을 위한 테스트도 별도로 제작해줬다.

*아 나 천재인듯? 꽤나 똘똘한 짓이었어!!*

하지만 이번 피드백은 `(이 정도의 간단한 로직은) 도메인 내부로 로직을 옮기고 조금 더 복잡한 validation 이 발생했을 때 해당 유틸을 구성해서 운영하면 좋겠네요.` 였다. 쳇!

그래도 혼자 열심히 고민하고 이렇게 저렇게 도전해봤으니 이렇게 피드백 받고 새로이 알아가는 거 아니겠는가!! 결국 내가 해냄!!! 암튼 해냄!!!!

### 낙관적 Lock? 어서오고~

2주차에 비관적 락을 통해 동시성 제어를 했던지라 이번에도 모든 동시성 제어를 비관적 락으로 할 예정이었다.

하지만 멘토링 청강을 하다가 알게 된 사실. [비관적 락보단 낙관적 락이 비용이 덜 들기 때문에 비관적 락보다 낙관적 락을 사용하는 것이 좋다.]

*엥… 그럴리가요… 우리 비관적 락이 그럴 아이가 아니란 말이에요…ㅠ*

열심히 흐린눈을 하며 비관적 락으로 진행을 했으나 나의 멱살을 잡고 끌고가주는 동기도 사용자 포인트는 낙관적 락으로 제어할거라고 하셨다. 당신마저 가버리면 난 어떡해… 어쩔 수 없이 나도 따라가야지… 라고 하기엔 나는 꽤나 옹고집이다. 왜? 왜 낙관적 락을 쓰는데?? 어째서???

비관적 락은 앞의 작업이 끝나면 작업을 다시 시작한다고? 아 그럼 사용자 한명이 포인트를 여러번 충전 및 사용하려고 할 때 앞의 작업이 끝날 때까지 기다렸다가 진행하겠구나… 앞에 한번의 작업이 끝나면 뒤에 작업을 다 실패로 만들어야해!! 그러면 retry 반복문도 쓰지 않는 낙관적 락을 사용하자!!

해서 부랴부랴 낙관적 락으로 수정하였다.

이 과정에서 왜 retry를 위한 반복문을 안쓰냐는 질문도 받아서 꽤나 혼란의 시기를 걸쳤는데 한번만 성공하면 되는 거야… 딱 한번만…!! 이라는 낙관적인 생각과 함께 동시성 테스트가 성공했다.

아 성공했음 된거잖아~ 한잔해~~

### 통합테스트 한번 실행에 20분이 걸리는 컴퓨터가 있다?

그 컴퓨터가 제 컴퓨터입니다.ㅎ

대학생 때 부터 쓰던 나의 작은 acer 노트북… 그렇다고 지금 새로 사기엔 돈도 없고 새로 셋팅할 엄두도 안나고 무엇보다도 올해에 새로 나올 맥북 에어를 사고 싶다!!!

그렇게 꾸역꾸역 사용하다보니 동시성 제어 테스트를 해야하는데 통합 테스트를 실행하면 리소스 부족인건지 테스트 컨테이너가 안 띄어지는 경우가 발생했다. 켜지지 않은 테스트 컨테이너를 켜기 위해 몇번이고 재시도를 하다가 결국 연결 실패라며 모든 테스트 케이스가 실패하는 상황이 발생했다.

늦었다고 생각했을 땐 늦는 겁니다 여러분. 지름신이 생길 때 빠르게 질러야 이런 일이 안생겨요…ㅎ

그렇다고 지금 노트북을 사러 나가기엔 목요일 밤 11시. 도전하면 도전할수록 시간이 더 오래걸리기 시작하면서 결국 한번에 20분이나 걸렸다.

테스트에 걸리는 시간을 최대한 줄이기 위해 SpringBoot가 최대한 적게 뜰 수 있도록 `IntegrationTestSupport` 라는 추상 클래스에 `@SrpingBootTest` 어노테이션을 때려넣고(?) 한번에 관리할 수 있도록 수정도 했다. 테스트 케이스 하나 하나 돌릴 때는 동일하지만 전체 테스트 할 때는 보다 적게 걸렸다. 이게 어디야ㅠㅠㅠ

결국 새벽 2시가 되어서 나를 멱살 잡고 끌고가주는 동기에게 내 프로젝트 좀 풀 받아줘… 테스트 좀 대신 해줘!!!!! 라며 해줘 메타를 실행했다. 근데 동기의 컴퓨터에선 너무나 빠르고 정확하게 돌아가는 나의 테스트들… 주인만 무는 개를 키운 느낌이었다.

매번 풀 받아서 확인해달라고 할 순 없으니 상상 속에서 실행하고 또 실행하여 완벽하다! 싶을 때마다 커밋하여 테스트를 해달라고 하였다. 물론 다 성공하진 못하고 커밋 취소를 여러번 해야만 했다… 그렇게라도 포기하지 않고 노력하는 내 모습에 애써 취하며 열심히 상상 코딩을 했다.

그러다가 마지막 주문/결제 동시성 제어 테스트를 커밋하고 부탁하려는 순간!! 다행히도 신은 나를 저버리지 않았다. 시간은 여전히 2~6분을 오가지만 어찌되었건 테스트의 결과가 나온다!! 연결 실패가 아니라고!!!

항해를 하는 동안 이 때만큼 신나게 테스트 코드를 돌릴 적이 없었다. 천사같은 동기와 환경이 좋지 않음에도 불구하고 구질구질하게(?) 매달리는 나의 끈기(집착?)덕분에 제출 할 수 있게 되어서 정말 다행이었다.

## 내가 느낀 것들

이미 앞에서 내가 해냄!을 말하면서 느낀 점들을 잔뜩 말한 것 같지만… 전체적으로 느낀 바를 말하자면 항해는 중독성이 쩐다는 거다!!

멘토링 할 때 5주차인데 어떠냐는 말씀에 **“힘들지만 재밌어요!!”** 라고 이야기를 드렸는데 동기들에게도 자주 하는 말이다.

`저걸 어떻게 해? → 이걸 이렇게 해볼까 저렇게 해볼까? → 이렇게 고쳐봐야지! → 이걸 해내네…` 이 1주일마다 반복된다. 이걸 어떻게 안좋아해?! 짜릿해! 최고야! 도파민 팡팡!!!

사실 혼자라면 못했을 것이다. 나의 옆에서 나를 응원해주고 같이 고민해주는 경덕 언니, 호민 오빠, 재영이와 나를 반갑게 맞이해주는 다른 동기들 덕분에 여기까지 오지 않았을까 싶다.
내가 zep에서 귀찮을 정도로 많이 찌르고 장난을 많이 치는데도 다 웃으며 받아줘서 고마울 뿐이다. 덕분에 수면이 부족해서 몸이 망가져가는 와중에도 우울해지지 않고 늘 밝게 지낼 수 있는 것 같다.

---

재밌는 건 4주차 과제의 범위를 동시성 제어까지인줄 알고 연차 두개를 쓰고도 시간이 부족해 울먹이면서 코딩하고 있었을 때 가장 힘이 되었던 건 놀랍게도 4주차 멘토링을 해주셨던 라이언 코치님이셨다.

라이언 코치님께서 11팀을 위한 슬랙 채널을 만들어주셨는데 사실 멘토링 때 잠깐 사용하고 더 이상 활동을 안할 줄 알았다. 연차를 쓰고 너무 터무니 없이 부족한 시간과 뭘해도 만족스럽지 못한 코드와 코치님께서 신경 많이 써주셨는데 이런 엉망인 과제를 제출하게 되었다는 사실에 많이 절망하고 다음 기수로 넘어갈까 라는 우스갯 소리도 하고 있었는데 라이언 코치님께 잘 하고 있느냐는 메시지가 왔다.

숨 넘어갈 정도로 스트레스를 받고 있는 상황에서 미완성이면 패스는 못주겠지만 피드백 칸이 열리니 제출만 하라는 농담 반 진담 반인 장난까지 들으니 뭔가 마음이 편해졌다.


**패스가 아니더라도 내가 얻어가면 되는 게 있으면 되는거지. 너무 완성에 목 매어있지 말자.**


내가 봐도 많이 부족한 코드를 제출했지만 난 최선을 다 했으니깐! 시간은 최대한 냈고 그 안에서 최대한 활용하려고 노력했으니깐!!! 투 페일?! 무섭지 않다!! 어서 와라!!!!!

했는데 투 패스다.. 심지어 따봉도 있었다… 엥?? 제가요?? 감히  받아도 되나요??

사실 너무 과분한 결과물이라 많이 부담스러워했다. 지금이라도 페일로 바꿔달라고 정정 요청을 드려야하는 건가? 아마도 내 과제보다는 내가 힘들어 하는 모습도 노력하는 모습도 다 보셨으니 앞으로도 힘내라는 의미로 주신 게 아닐까? 답을 찾을 수 없는 문제만이 맴돌았다.

고심 끝에 메시지를 드렸더니 잘하셨다고 지금까지 성장 잘 해오셨다고 말씀해주셨다.

눈물이 날 것 같은 하루였다.

--- 
항해를 하면서 많은 것들을 배우지만 역시 사람을 움직이는 건 기술이 아니라 사람이지 않을까 싶다.

기술을 배우고자 하는 욕망으로 항해에 왔지만 결국 이 욕망을 이루게 만드는 건 나의 의지보다는 같이 있는 사람들 덕분인 것 같다.

잠깐이라도 나와 함께 해준 모든 사람들에게 감사하다고 전하고 싶다.
여러분들 덕분에 제가 있어요!! 사랑해요 다들!!!!!!